{
  "name": "api",
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "root": "apps/api",
  "sourceRoot": "apps/api/app",
  "implicitDependencies": ["docker", "shared-python"],
  "release": {
    "docker": {
      "repositoryName": "theexperiencecompany/gaia"
    }
  },
  "targets": {
    "build": {
      "executor": "nx:noop",
      "cache": true,
      "inputs": ["production"],
      "outputs": []
    },
    "docker:build": {
      "executor": "nx:run-commands",
      "options": {
        "command": "docker build -f apps/api/Dockerfile -t apps-api -t ghcr.io/theexperiencecompany/gaia:latest . && docker push ghcr.io/theexperiencecompany/gaia:latest",
        "cwd": "."
      },
      "cache": true,
      "inputs": ["production", "^production"]
    },
    "sync": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uv sync --frozen --group backend --group dev",
        "cwd": "{projectRoot}"
      },
      "cache": true,
      "inputs": ["{projectRoot}/pyproject.toml", "{projectRoot}/uv.lock"],
      "outputs": ["{projectRoot}/.venv"]
    },
    "dev": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uv run --group backend uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload --reload-dir app --log-level info",
        "cwd": "{projectRoot}"
      }
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uvx ruff check .",
        "cwd": "{projectRoot}"
      },
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/apps/api/pyproject.toml",
        "{workspaceRoot}/apps/api/ruff.toml",
        "^production"
      ],
      "outputs": []
    },
    "lint:fix": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uvx ruff check . --fix",
        "cwd": "{projectRoot}"
      },
      "cache": false
    },
    "format": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uvx ruff format .",
        "cwd": "{projectRoot}"
      },
      "cache": false
    },
    "format:check": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uvx ruff format . --check",
        "cwd": "{projectRoot}"
      },
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/apps/api/pyproject.toml",
        "{workspaceRoot}/apps/api/ruff.toml"
      ]
    },
    "type-check": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uv run --group backend --group dev mypy app --ignore-missing-imports",
        "cwd": "{projectRoot}"
      },
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/apps/api/pyproject.toml",
        "^production"
      ]
    },
    "worker": {
      "executor": "nx:run-commands",
      "options": {
        "command": "uv run --group backend arq app.worker.WorkerSettings",
        "cwd": "{projectRoot}"
      }
    },
    "clean": {
      "executor": "nx:run-commands",
      "options": {
        "command": "find . -type d -name '__pycache__' -exec rm -rf {} + && find . -type f -name '*.pyc' -delete",
        "cwd": "{projectRoot}"
      }
    }
  }
}
