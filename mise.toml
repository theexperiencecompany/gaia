# Root mise.toml for GAIA monorepo
#
# This file defines tasks and tools for the entire GAIA project.
# mise is a task runner and tool manager that handles both backend and frontend.
#
# Quick Start:
#   mise setup           # Complete project setup
#   mise dev:all         # Start both backend and frontend
#   mise tasks               # List all available commands
#
# Documentation: https://docs.heygaia.io/developers/commands
#
# Common Commands:
#   Development:  mise dev:backend, mise dev:frontend
#   Setup:        mise setup, mise install:all
#   Code Quality: mise lint:all, mise format:all
#   Docker:       mise docker:up, mise docker:down
#
# Run from subdirectories:
#   mise -C backend dev     # Run backend dev from any directory
#   mise -C frontend build  # Run frontend build from any directory

[tools]
python = "3.11"
node = "22"

[env]
_.python.venv = { path = "backend/.venv", create = true }
MISE_NODE_COREPACK = "1"

# Development
[tasks."dev:backend"]
description = "Run backend development server"
run = "mise -C backend dev"

[tasks."dev:frontend"]
description = "Run frontend development server"
run = "mise -C frontend dev"

[tasks."dev:all"]
description = "Run both backend and frontend"
depends = ["dev:backend", "dev:frontend"]

# Installation
[tasks."check:env"]
description = "Check if environment files exist"
run = '''
if [ ! -f "backend/.env" ] || [ ! -f "frontend/.env" ]; then
    echo "‚ùå Environment files not found!"
    echo ""
    echo "Copy example files:"
    echo "  cp backend/.env.example backend/.env"
    echo "  cp frontend/.env.example frontend/.env"
    exit 1
fi
'''

[tasks."setup:backend"]
description = "Set up backend dependencies"
run = "mise -C backend install"
depends = ["check:env"]

[tasks."setup:frontend"]
description = "Set up frontend dependencies"
run = "mise -C frontend install"

[tasks."install:all"]
description = "Install all dependencies"
depends = ["setup:backend", "setup:frontend"]

[tasks.setup]
description = "Complete project setup"
depends = ["check:env", "docker:up", "setup:backend", "setup:frontend"]
run = "mise -C backend seed:models"

# Code Quality
[tasks."lint:all"]
description = "Lint both backend and frontend"
run = ["mise -C backend lint", "mise -C frontend lint"]

[tasks."format:all"]
description = "Format both backend and frontend"
run = ["mise -C backend format", "mise -C frontend format"]

[tasks."clean:all"]
description = "Clean both backend and frontend"
run = ["mise -C backend clean", "mise -C frontend clean"]

# Docker
[tasks."docker:up"]
description = "Start all docker services"
run = "docker compose --profile backend up -d"

[tasks."docker:down"]
description = "Stop all docker services"
run = "docker compose --profile backend down"

[tasks."docker:logs"]
description = "View docker logs"
run = "docker compose --profile backend logs -f"

[tasks."docker:restart"]
description = "Restart all docker services"
depends = ["docker:down", "docker:up"]
